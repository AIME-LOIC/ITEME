<!DOCTYPE html>
<html lang="rw">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parent Check-in</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      padding: 40px 20px;
      background-color: #e6f7ff;
      color: #333;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    h2 { color: #007bff; margin-bottom: 25px; font-weight: 700; font-size: 1.8rem; }
    form {
      background: white; padding: 30px; border-radius: 12px; width: 350px;
      max-width: 95%; margin: 20px auto; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border: 1px solid #cceeff;
    }
    input[type="text"], select {
      width: 100%; padding: 12px 15px; margin: 10px 0; border: 1px solid #ccc;
      border-radius: 6px; transition: border-color 0.3s, box-shadow 0.3s; font-size: 16px;
      appearance: none;
    }
    input[type="text"]::placeholder { color: #999; }
    input[type="text"]:focus, select:focus { border-color: #007bff; box-shadow: 0 0 5px rgba(0,123,255,0.3); outline: none; }
    .select-wrapper { position: relative; }
    .select-wrapper::after { content: '▼'; position: absolute; top: 50%; right: 15px; transform: translateY(-50%); color: #555; pointer-events: none; font-size: 0.8rem; }
    button[type="submit"] {
      width: 100%; padding: 12px; margin-top: 20px; background: #007bff; color: white;
      border: none; border-radius: 6px; cursor: pointer; font-size: 17px; font-weight: bold;
      transition: background-color 0.3s, transform 0.1s; box-shadow: 0 4px 10px rgba(0,123,255,0.3);
    }
    button[type="submit"]:hover { background-color: #0056b3; transform: translateY(-1px); }
    button[type="submit"]:active { transform: translateY(0); }
    a { text-decoration: none; color: #007bff; font-weight: 500; }
    footer { margin-top: 20px; }
    .toast {
      position: fixed; bottom: 30px; right: 30px; background: #28a745; color: white;
      padding: 15px 25px; border-radius: 8px; font-weight: 500; font-size: 16px;
      opacity: 0; transform: translateY(20px); transition: all 0.4s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1000;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
    @media (max-width: 400px) { body { padding: 10px; } h2 { font-size: 1.5rem; } form { padding: 20px; margin: 10px auto; } input, select, button { padding: 10px; font-size: 15px; } }
  </style>
</head>
<body>

  <h2>Menyesha Umwana cg Shaka umwana kuri visite <br> Iteme</h2>

  <form id="arrivalForm">
    <input type="text" name="student_name" placeholder="Amazina y'umwana" required>
    <div class="select-wrapper">
      <select name="class_name" required>
        <option value="" selected disabled>Hitamo Ishuri ry'umwana</option>
        <option value="" disabled>O'Leve</option>
        <option value="S1">S1</option>
        <option value="S2">S2</option>
        <option value="S3">S3</option>
        <option value="" disabled>A'Leve</option>
        <option value="S4">S4/L3</option>
        <option value="S5">S5/L4</option>
        <option value="S6">S6/L5</option>
      </select>
    </div>
    <button type="submit">Menyesha Iteme</button>
  </form>

  <a href="https://iteme-charity-familt-system.vercel.app/">Menya Byinshi Kw'Iteme</a>

  <footer>
    <h2 style="text-transform: uppercase; font-size: 20px;">
      powered by <span><a href="https://onepercent-rwanda.onrender.com" style="color: rgb(28, 253, 7);">1%</a></span> & ICF
    </h2>
  </footer>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ruxiswyfpkbatnzcbvog.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1eGlzd3lmcGtiYXRuemNidm9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0ODI4NzYsImV4cCI6MjA3ODA1ODg3Nn0.M7lYjHx5rPo3fziZtmi4FP-skH6FVKopCjM5O2246QY"; // replace with your anon/public key
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const toast = document.getElementById('toast');
    function showToast(msg, type='success') {
      toast.textContent = msg;
      toast.style.backgroundColor = type === 'success' ? '#28a745' : '#dc3545';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Request notification permission
    if(Notification.permission !== "granted") Notification.requestPermission();

    let parentStudentName = '';

    document.getElementById('arrivalForm').addEventListener('submit', e => {
      e.preventDefault();
      parentStudentName = e.target.student_name.value.trim();
      showToast(`Ubutumwa bwoherejwe: ${parentStudentName}`);
      e.target.reset();
    });

    // Realtime subscription filtered by student name
    supabase.channel('arrival-updates')
      .on('postgres_changes', {
        event: 'UPDATE',
        schema: 'public',
        table: 'arrival'
      }, payload => {
        if(payload.new.student_name === parentStudentName && payload.new.status === 'active') {
          if(Notification.permission === "granted") {
            new Notification("Iteme Notification", {
              body: `Umwana ${payload.new.student_name} yemejwe!`,
              icon: "https://cdn-icons-png.flaticon.com/512/726/726623.png"
            });
          }
          showToast(`Umwana ${payload.new.student_name} yemejwe!`);
        }
      })
      .subscribe()
      .then(() => console.log("✅ Subscribed to updates"))
      .catch(err => console.error("❌ Subscription failed:", err));
  </script>

</body>
</html>
